
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deteksi Koordinat (URL & GPS)</title>
  <style>
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; padding: 20px; max-width: 800px; margin: auto; line-height: 1.5; }
    input[type="text"]{ width: 100%; padding: 10px; margin: 8px 0; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; }
    #out { background: #f7f7f7; padding: 15px; border-radius: 6px; border: 1px solid #e5e7eb; min-height: 50px; white-space: pre-wrap; word-wrap: break-word; }
    .btn { padding: 10px 16px; border: none; background: #2563eb; color: white; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.2s ease-in-out; }
    .btn:active { transform: translateY(1px); }
    .btn:disabled { background: #94a3b8; cursor: not-allowed; }
    .maps-link { display: inline-block; margin-top: 10px; padding: 8px 12px; background: #dbeafe; color: #1e40af; text-decoration: none; border-radius: 4px; font-weight: bold; border: 1px solid #bfdbfe; }
    .maps-link:hover { background: #bfdbfe; }
  </style>
</head>
<body>
  <h1>Ambil Latitude & Longitude</h1>
  <p>Deteksi koordinat dari URL atau ambil langsung dari <strong>GPS Perangkat</strong>.</p>

  <label>Tempel URL di sini (opsional):</label>
  <input id="urlInput" type="text" placeholder="https://www.google.com/maps/..." />

  <div style="display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap;">
    <button id="parseBtn" class="btn">Parse URL</button>
    <button id="getGpsBtn" class="btn" style="background:#7c3aed;">Dapatkan Lokasi GPS</button>
    <button id="copyBtn" class="btn">Salin Lat,Lon</button>
    <button id="copyLat" class="btn" style="background:#059669;">Lat</button>
    <button id="copyLon" class="btn" style="background:#059669;">Lon</button>
  </div>

  <div id="result">
    <h3>Hasil:</h3>
    <div id="out">Menunggu input atau perintah...</div>
  </div>

  <script>
    const patterns = [
      { name: 'google-@-pattern', re: /@(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)(?:[,\/]|$)/i },
      { name: 'google-q', re: /[?&]q=(-?\d+(?:\.\d+)?)[,+\s](-?\d+(?:\.\d+)?)/i },
      { name: 'lat-lon-params', re: /[?&](?:lat|latitude)=(-?\d+(?:\.\d+)?)[^&]*&(?:lon|lng|longitude)=(-?\d+(?:\.\d+)?)/i },
      { name: 'll-param', re: /[?&]ll=(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)/i },
      { name: 'google-3d-4d', re: /!3d(-?\d+(?:\.\d+)?)!4d(-?\d+(?:\.\d+)?)/i },
      { name: 'osm-hash-map', re: /#map=\d+\/(-?\d+(?:\.\d+)?)\/(-?\d+(?:\.\d+)?)/i },
      { name: 'bing-cp', re: /[?&]cp=(-?\d+(?:\.\d+)?)~(-?\d+(?:\.\d+)?)/i },
      { name: 'lat-lon-simple', re: /[?&](?:lon|lng|longitude)=(-?\d+(?:\.\d+)?)[^&]*&(?:lat|latitude)=(-?\d+(?:\.\d+)?)/i },
      { name: 'two-decimals-anywhere', re: /(-?\d{1,3}\.\d+)[ ,\/]+(-?\d{1,3}\.\d+)/ }
    ];

    function parseCoordinatesFromURL(url) {
      if (!url) return null;
      for (const p of patterns) {
        const m = url.match(p.re);
        if (m) {
          let lat = parseFloat(m[1]);
          let lon = parseFloat(m[2]);
          if (lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) return { lat, lon, source: p.name };
        }
      }
      return null;
    }

    function showResult(obj) {
      const out = document.getElementById('out');
      if (!obj) {
        out.textContent = 'Koordinat tidak ditemukan.';
        return;
      }
      
      // Menggunakan format SEARCH agar muncul PIN MERAH
      const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${obj.lat},${obj.lon}`;
      
      out.innerHTML = `<strong>Sukses mendeteksi koordinat!</strong>
Sumber: ${obj.source}
Latitude: <code>${obj.lat}</code>
Longitude: <code>${obj.lon}</code>

<a href="${mapsUrl}" target="_blank" class="maps-link">üìç Buka di Google Maps (Muncul Pin)</a>
<br><small style="color:gray;">${mapsUrl}</small>`;
      
      window._lastCoords = obj;
    }
    
    function feedbackAndRestore(buttonId, successText) {
      const btn = document.getElementById(buttonId);
      const originalText = btn.textContent;
      const originalBg = btn.style.backgroundColor; 
      btn.textContent = successText;
      btn.style.backgroundColor = '#10B981';
      btn.style.transform = 'scale(1.05)'; 
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.backgroundColor = originalBg;
        btn.style.transform = 'scale(1.0)';
      }, 1500);
    }

    document.getElementById('parseBtn').addEventListener('click', () => {
      const url = document.getElementById('urlInput').value.trim();
      if(!url) return alert("Masukkan URL terlebih dahulu.");
      showResult(parseCoordinatesFromURL(url));
    });

    document.getElementById('getGpsBtn').addEventListener('click', () => {
      const btn = document.getElementById('getGpsBtn');
      const out = document.getElementById('out');
      if (!navigator.geolocation) { alert("Browser tidak mendukung GPS."); return; }
      out.textContent = "Meminta izin GPS...";
      btn.disabled = true;
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const coords = { lat: position.coords.latitude, lon: position.coords.longitude, source: 'GPS Perangkat' };
          showResult(coords);
          document.getElementById('urlInput').value = `${coords.lat}, ${coords.lon}`;
          btn.disabled = false;
          feedbackAndRestore('getGpsBtn', 'Lokasi Didapat!');
        },
        (error) => { out.textContent = "Error: " + error.message; btn.disabled = false; },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      if (!window._lastCoords) return alert('Belum ada koordinat.');
      await navigator.clipboard.writeText(`${window._lastCoords.lat},${window._lastCoords.lon}`);
      feedbackAndRestore('copyBtn', 'Disalin!');
    });

    document.getElementById('copyLat').addEventListener('click', async () => {
      if (!window._lastCoords) return alert('Belum ada koordinat.');
      await navigator.clipboard.writeText(window._lastCoords.lat);
      feedbackAndRestore('copyLat', 'Disalin!');
    });

    document.getElementById('copyLon').addEventListener('click', async () => {
      if (!window._lastCoords) return alert('Belum ada koordinat.');
      await navigator.clipboard.writeText(window._lastCoords.lon);
      feedbackAndRestore('copyLon', 'Disalin!');
    });
  </script>
</body>
</html>
