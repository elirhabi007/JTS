
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deteksi Koordinat (URL & GPS)</title>
  <style>
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; padding: 20px; max-width: 800px; margin: auto; }
    input[type="text"]{ width: 100%; padding: 8px; margin: 8px 0; box-sizing: border-box; }
    pre{ background:#f7f7f7; padding:10px; border-radius:6px; white-space: pre-wrap; word-wrap: break-word; }
    .btn { 
      padding:8px 12px; 
      border:none; 
      background:#2563eb; 
      color:white; 
      border-radius:6px; 
      cursor:pointer; 
      transition: all 0.2s ease-in-out;
    }
    .btn:active{ transform: translateY(1px); }
    .btn:disabled { background: #94a3b8; cursor: not-allowed; }
  </style>
</head>
<body>
  <h1>Ambil Latitude & Longitude</h1>
  <p>Deteksi dari URL atau ambil langsung dari <strong>GPS Perangkat</strong>.</p>

  <label>Tempel URL di sini (untuk parse manual):</label>
  <input id="urlInput" type="text" placeholder="https://www.google.com/maps/..." />

  <div style="display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap;">
    <button id="parseBtn" class="btn">Parse URL</button>
    <!-- Tombol yang diubah fungsinya -->
    <button id="getGpsBtn" class="btn" style="background:#7c3aed;">Dapatkan Lokasi GPS</button>
    
    <button id="copyBtn" class="btn">Salin Koordinat</button>
    <button id="copyLat" class="btn" style="background:#059669;">Copy Lat</button>
    <button id="copyLon" class="btn" style="background:#059669;">Copy Lon</button>
  </div>

  <div id="result">
    <h3>Hasil:</h3>
    <pre id="out">Menunggu input atau perintah...</pre>
  </div>

  <script>
    const patterns = [
      { name: 'google-@-pattern', re: /@(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)(?:[,\/]|$)/i },
      { name: 'google-q', re: /[?&]q=(-?\d+(?:\.\d+)?)[,+\s](-?\d+(?:\.\d+)?)/i },
      { name: 'lat-lon-params', re: /[?&](?:lat|latitude)=(-?\d+(?:\.\d+)?)[^&]*&(?:lon|lng|longitude)=(-?\d+(?:\.\d+)?)/i },
      { name: 'll-param', re: /[?&]ll=(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)/i },
      { name: 'google-3d-4d', re: /!3d(-?\d+(?:\.\d+)?)!4d(-?\d+(?:\.\d+)?)/i },
      { name: 'osm-hash-map', re: /#map=\d+\/(-?\d+(?:\.\d+)?)\/(-?\d+(?:\.\d+)?)/i },
      { name: 'bing-cp', re: /[?&]cp=(-?\d+(?:\.\d+)?)~(-?\d+(?:\.\d+)?)/i },
      { name: 'lat-lon-simple', re: /[?&](?:lon|lng|longitude)=(-?\d+(?:\.\d+)?)[^&]*&(?:lat|latitude)=(-?\d+(?:\.\d+)?)/i },
      { name: 'two-decimals-anywhere', re: /(-?\d{1,3}\.\d+)[ ,\/]+(-?\d{1,3}\.\d+)/ }
    ];

    function parseCoordinatesFromURL(url) {
      if (!url) return null;
      for (const p of patterns) {
        const m = url.match(p.re);
        if (m) {
          let lat = parseFloat(m[1]);
          let lon = parseFloat(m[2]);
          if (lat >= -90 && lat <= 90 && lon >= -180 && lon <= 180) return { lat, lon, source: p.name };
        }
      }
      return null;
    }

    function showResult(obj) {
      const out = document.getElementById('out');
      if (!obj) return out.textContent = 'Koordinat tidak ditemukan.';
      out.textContent = `Sukses mendeteksi koordinat!\nSumber: ${obj.source}\nLatitude: ${obj.lat}\nLongitude: ${obj.lon}\n\nLink preview Google Maps:\nhttps://www.google.com/maps/@${obj.lat},${obj.lon},15z`;
      window._lastCoords = obj;
    }
    
    function feedbackAndRestore(buttonId, successText) {
      const btn = document.getElementById(buttonId);
      const originalText = btn.textContent;
      const originalBg = btn.style.backgroundColor; 
      
      btn.textContent = successText;
      btn.style.backgroundColor = '#10B981';
      btn.style.transform = 'scale(1.05)'; 

      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.backgroundColor = originalBg;
        btn.style.transform = 'scale(1.0)';
      }, 1500);
    }

    // --- EVENT LISTENERS ---

    document.getElementById('parseBtn').addEventListener('click', () => {
      const url = document.getElementById('urlInput').value.trim();
      showResult(parseCoordinatesFromURL(url));
    });

    // FUNGSI BARU: Ambil GPS Perangkat
    document.getElementById('getGpsBtn').addEventListener('click', () => {
      const btn = document.getElementById('getGpsBtn');
      const out = document.getElementById('out');
      
      if (!navigator.geolocation) {
        alert("Browser Anda tidak mendukung fitur GPS.");
        return;
      }

      out.textContent = "Sedang meminta izin dan mengambil lokasi GPS...";
      btn.disabled = true;

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const coords = {
            lat: position.coords.latitude,
            lon: position.coords.longitude,
            source: 'Device-GPS (Akurat hingga ' + Math.round(position.coords.accuracy) + ' meter)'
          };
          showResult(coords);
          document.getElementById('urlInput').value = `${coords.lat}, ${coords.lon}`;
          btn.disabled = false;
          feedbackAndRestore('getGpsBtn', 'Lokasi Ditemukan!');
        },
        (error) => {
          let errorMsg = "Gagal mengambil lokasi.";
          if (error.code === 1) errorMsg = "Izin GPS ditolak oleh pengguna.";
          else if (error.code === 2) errorMsg = "Posisi tidak tersedia (periksa sinyal GPS).";
          else if (error.code === 3) errorMsg = "Waktu permintaan habis (timeout).";
          
          out.textContent = "Error: " + errorMsg;
          btn.disabled = false;
          alert(errorMsg);
        },
        { 
          enableHighAccuracy: true, // Mengaktifkan GPS (bukan hanya IP)
          timeout: 10000, 
          maximumAge: 0 
        }
      );
    });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      if (!window._lastCoords) return alert('Belum ada koordinat.');
      await navigator.clipboard.writeText(`${window._lastCoords.lat},${window._lastCoords.lon}`);
      feedbackAndRestore('copyBtn', 'Disalin!');
    });

    document.getElementById('copyLat').addEventListener('click', async () => {
      if (!window._lastCoords) return alert('Belum ada koordinat.');
      await navigator.clipboard.writeText(window._lastCoords.lat);
      feedbackAndRestore('copyLat', 'Lat Disalin!');
    });

    document.getElementById('copyLon').addEventListener('click', async () => {
      if (!window._lastCoords) return alert('Belum ada koordinat.');
      await navigator.clipboard.writeText(window._lastCoords.lon);
      feedbackAndRestore('copyLon', 'Lon Disalin!');
    });
  </script>
</body>
</html>
